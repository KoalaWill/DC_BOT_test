
const { SlashCommandBuilder, EmbedBuilder, Client } = require("discord.js");
const fs = require("fs");

// [è®€æª”] -> [è§£æ] -> [åšäº‹]  -> [å›æ‡‰] -> [å­˜æª”]

const default_board = ["R", "N", "B", "Q", "K", "B", "N", "R",
"P", "P", "P", "P", "P", "P", "P", "P",
"0", "0", "0", "0", "0", "0", "0", "0",
"0", "0", "0", "0", "0", "0", "0", "0",
"0", "0", "0", "0", "0", "0", "0", "0",
"0", "0", "0", "0", "0", "0", "0", "0",
"p", "p", "p", "p", "p", "p", "p", "p",
"r", "n", "b", "q", "k", "b", "n", "r"]

module.exports = {
    data: new SlashCommandBuilder().setName("chess").setDescription("Plat a chess game!(I think)"),
    async execute(client, interaction) {
        // //éš¨æ©Ÿå–å¾—çµæœï¼ˆ1~6)
        // let diceResult = Math.floor(Math.random() * 11) - 4;

        // //å¾çµæœè¨ˆç®—ç²å¾—/å¤±å»çš„ money (ä¾‹: 1:-3 2:-2 3:-1 4:+1 5:+2 6:+3)
        // let earnings = diceResult - 3;
        
        //è®€å– players.json ä¸¦ parse æˆ players
        const data = fs.readFileSync('chess.json');
        let players = JSON.parse(data);

        //åœ¨æ‰€æœ‰è³‡æ–™ä¸­å°‹æ‰¾å‘¼å«æ­¤æŒ‡ä»¤ç©å®¶çš„è³‡æ–™
        let found = false;
        for (let i = 0; i < players.length; i++) {
            //æœ‰è³‡æ–™çš„case
            if (players[i].id == interaction.user.id) {
                found = true;
                if (players[i].gameMod == "OFF") {
                    players[i].gameMod = true;
                    players[i].board = {}
                }
                // players[i].money += earnings;
                
                //å›å¾©çµæœ
                // const diceEmbed = new EmbedBuilder()
                //     .setColor("#5865F2")
                //     .setTitle(`ğŸ²ä½ å¾—åˆ°äº† ${diceResult}`)
                //     .setDescription(`çµæœï¼š${earnings}å…ƒ\nä½ ç¾åœ¨æœ‰ ${players[i].money} å…ƒ!`);
                // interaction.reply({ embeds: [diceEmbed] });
                break;
            }
        }

        //å¦‚æœæ²’æœ‰è³‡æ–™å°±å‰µå»ºä¸€å€‹æ–°çš„ä¸¦å›è¦†çµæœ
        if (found == false) {
            //å‰µå»ºæ–°çš„ç©å®¶è³‡æ–™
            players.push({ id: interaction.user.id, board:default_board });

            //å›å¾©çµæœ
            const diceEmbed = new EmbedBuilder()
                .setColor("#5865F2")
                .setTitle(`ğŸ²ä½ å¾—åˆ°äº† ${diceResult}`)
                .setDescription(`çµæœï¼š${earnings}å…ƒ\nä½ ç¾åœ¨æœ‰ ${500 + earnings} å…ƒ!`);
            interaction.reply({ embeds: [diceEmbed] });
        }

        //stringify players ä¸¦å­˜å› players.json
        const json = JSON.stringify(players);
        fs.writeFileSync('player.json', json);
    },
};
